<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="X-Frame-Options" content="allow" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes">    

    <title>Remote Trainer</title>

    <link rel="stylesheet" href="app.css" type="text/css" />

    <script src="Common/exception.js"></script>
    <script src="Common/event.js"></script>
    <script src="Common/common.js"></script>
    <script src="Libraries/jquery-1.7.1.min.js"></script>
    <script src="Libraries/knockout-3.4.2.js"></script>
    <script src="Libraries/moment-2.19.1.min.js"></script>
    <script src="Libraries/JSBridge.js"></script>
    <script src="UI/koCustomBindings.js"></script>
    <script src="Data/category.js"></script>
    <script src="Data/exercise.js"></script>
    <script src="Data/serie.js"></script>
    <script src="Data/set.js"></script>
    <script src="Data/workout.js"></script>
    <script src="Service/JSBridgeProvider.js"></script>
    <script src="app.js"></script>
</head>
<body style="background: silver">
    <div id="app_root" data-bind="app: $data"></div>

    <script type="text/javascript">
        $(document).ready(function () {
            RemoteTrainer.Program.instance.runApplication(window.location.search.substring(4));
        });
    </script>

    <script id="tmplApplication" type="text/html">
        <div class="page" style="width: 100%; height: 100%; background: #eeeeee">
            <div class="tabControl">
                <div class="tabItem" data-bind="click: function() { onTabItemClicked('Overview'); }, css: { selected: uiSelectedTabIndex() === 0 }"><h2>Overview</h2></div>
                <div class="tabItem" data-bind="click: function() { onTabItemClicked('Workout'); }, css: { selected: uiSelectedTabIndex() === 1 }"><h2>Workout</h2></div>
                <div class="tabItem" data-bind="click: function() { onTabItemClicked('Set'); }, css: { selected: uiSelectedTabIndex() === 2 }"><h2>Set</h2></div>
            </div>
            <div class="content">
                <div style="background-image: url('Images/background.jpg'); background-repeat:no-repeat; background-size:cover; background-position: center; background-attachment: fixed; padding: 0px; height: 100%; overflow: auto">
                    <!-- ko template: { name: uiContentTemplateName } --><!-- /ko -->
                </div>
            </div>
            <!-- ko if: uiFooterTemplateName() -->
            <div style="width: 100%; text-align: center; background: #333333; color: white; border-bottom: solid 1px black">
                <!-- ko template: { name: uiFooterTemplateName } --><!-- /ko -->
            </div>
            <!-- /ko -->
        </div>
    </script>

    <script id="tmplWorkoutDetails" type="text/html">
        <div style="padding: 10px">
            <!-- ko foreach: workout().sets -->
            <!-- ko if: order() > 0 -->
            <div class="break" style="padding: 5px; box-sizing: border-box; font-size: 1em;">
                &nbsp;
            </div>
            <!-- /ko -->
            <div class="setDetail">
                <!-- ko foreach: exercises -->
                <div style="display: flex; flex-direction: row; border-bottom: dashed 1px black; cursor: pointer" data-bind="style: { backgroundColor: category.colorDark }, click: $parent.show.bind($parent)">
                    <div style="flex: 1; padding: 5px; font-weight: bold" data-bind="text: name" />
                    <!-- ko foreach: $parent.series -->
                    <!-- ko if: exercise === $parent -->
                    <div style="border-left: solid 1px black; padding: 5px; width: 50px; text-align: center" data-bind="
                                style: { backgroundColor: $data.uiStatus() === RemoteTrainer.Data.SerieStatus.Finished ? $parent.category.colorLight : 'white' },
                                text: (uiAmount() !== undefined ? uiAmount() : '') + (uiAmount() !== undefined && uiReps() !== undefined ? '/' : '') + (uiReps() !== undefined ? uiReps() : '')" />
                    <!-- /ko -->
                    <!-- /ko -->
                </div>
                <!-- /ko -->
                <div class="optionPanel" data-bind="visible: uiOptionsPanelState() === RemoteTrainer.Data.OptionPanelState.Opened">
                    <!-- ko if: uiOptionsContentTemplate() -->
                    <!-- ko template: { name: uiOptionsContentTemplate } --><!-- /ko -->
                    <!-- /ko -->
                </div>
                <!-- ko if: uiOptionsPanelState() !== RemoteTrainer.Data.OptionPanelState.Opened-->
                        <!-- ko if: uiStatus() === RemoteTrainer.Data.SerieStatus.Finished -->
                        <div class="setinfo">
                            <img src="Images/serieStatusFinished.png" style="height: 16px; top: 2px; position: relative" /> Completed in: <b><span data-bind="text: uiDurationLabel" /></b> (<span data-bind="text: uiExercisingLabel" />), Avg. Difficulty: <b><span data-bind="text: uiAverageDifficulty" /></b>
                        </div>
                        <!-- /ko -->
                        <!-- ko if: uiStatus() === RemoteTrainer.Data.SerieStatus.Queued -->
                        <div class="setinfo">
                            <img src="Images/serieStatusQueued.png" style="height: 16px; top: 2px; position: relative; cursor: pointer" data-bind="click: showHideSettings" /> Estimated start at: <b>10:22</b>
                        </div>
                        <!-- /ko -->
                        <!-- ko if: uiStatus() === RemoteTrainer.Data.SerieStatus.Ready -->
                        <div class="setinfo">
                            <img src="Images/serieStatusReady.png" style="height: 16px; top: 2px; position: relative" /> In Break <b><span data-bind="text: breaks[0]" /></b>
                        </div>
                        <!-- /ko -->
                        <!-- ko if: uiStatus() === RemoteTrainer.Data.SerieStatus.Running -->
                        <div class="setinfo">
                            <img src="Images/serieStatusReady.png" style="height: 16px; top: 2px; position: relative" /> Running for <b><span data-bind="text: uiDurationLabel" /></b>
                        </div>
                        <!-- /ko -->
                <!-- /ko -->
            </div>
            <!-- /ko -->
            <div class="setDetail" style="margin: 10px; margin-bottom: 0px; background: white; cursor: pointer; padding: 10px; text-align: center; font-weight: bold; font-size: 1.2em">
                <img src="Images/add.png" style="height: 16px" /> Add Set
            </div>
        </div>
    </script>

    <script id="tmplSetDetails" type="text/html">
        <!-- ko with: workout().displayedSet() -->
        <div class="break" style="padding: 5px; box-sizing: border-box; font-size: 1em">
            &nbsp;
        </div>
        <div class="set" style="padding: 10px">
            <!-- ko foreach: series -->
            <!-- ko template: { name: 'tmplSerie' } --><!-- /ko -->
            <!-- /ko -->
        </div>
        <!-- /ko -->
    </script>

    <script id="tmplSetDetailsFooter" type="text/html">
        <!-- ko with: workout().displayedSet() -->
        <div style="display: flex; flex-direction: row"> 
            <h2 data-bind="click: showPrevious" style="flex: 1 1; text-align: left; cursor:pointer; padding-left: 5px"><!-- ko if: previous -->< Previous Set<!-- /ko --></h2>        
            <h2 data-bind="click: showRunningSet" style="flex: 1 1; text-align: center; cursor:pointer; border-left: dashed 1px white; border-right: dashed 1px white">
            <!-- ko if: uiStatus() !== RemoteTrainer.Data.SerieStatus.Running && uiStatus() !== RemoteTrainer.Data.SerieStatus.Ready -->Running Set<!-- /ko -->
            </h2>            
            <h2 data-bind="click: showNext" style="flex: 1 1; text-align: right; cursor: pointer; padding-right: 5px"><!-- ko if: next -->Next Set ><!-- /ko --></h2>
        </div>
        <!-- /ko -->
    </script>


    <script id="tmplSerie" type="text/html">
        <div class="serieHeader" data-bind="style: { backgroundColor: exercise.category.colorDark }" style="border: solid 1px black; border-bottom: 0px">
            <div data-bind="text: exercise.name" style="padding: 5px; font-weight: bold"></div>
        </div>
        <div class="serie" style="border: solid 1px black; border-top: dashed 1px black">
            <div class="optionPanel" data-bind="visible: uiOptionsPanelState() === RemoteTrainer.Data.OptionPanelState.Opened">
                <!-- ko if: uiOptionsContentTemplate() -->
                    <!-- ko template: { name: uiOptionsContentTemplate } --><!-- /ko -->
                <!-- /ko -->
                <div class="cell button imgStatus" style="width: 55px" data-bind="style: { backgroundColor: exercise.category.colorLight, backgroundImage: 'url(\'Images/serieStatus' + RemoteTrainer.Data.SerieStatus[uiStatus()] + '.png\')' }, click: onStatusClicked"></div>
            </div>
            <!-- ko if: uiStatus() === RemoteTrainer.Data.SerieStatus.Ready -->
            <div class="cell button imgStatus" style="width: 55px" data-bind="style: { backgroundColor: exercise.category.colorLight, backgroundImage: 'url(\'Images/serieStatus' + RemoteTrainer.Data.SerieStatus[uiStatus()] + '.png\')' }, click: onStatusClicked"></div>
            <!-- /ko -->
            <div class="info" data-bind="style: { backgroundColor: 'white' }">
                <!-- ko if: uiStatus() === RemoteTrainer.Data.SerieStatus.Ready -->
                <div style="width: 100%;">
                    <br />
                    In Break: <span style="font-size: 1.4em; font-weight: bold; font-style: normal" data-bind="text: parent.breaks[order]" />
                </div>
                <!-- /ko -->
                <!-- ko if: uiStatus() === RemoteTrainer.Data.SerieStatus.Finished -->
                <div>
                    Duration: <span class="highlight" data-bind="text: uiDuration"/><br />
                    Difficulty: <span class="highlight link" style="cursor: pointer" data-bind="text: uiDifficulty, click: onStatusClicked"/>
                </div>
                <!-- /ko -->
            </div>
            <!-- ko if: uiAmount() > 0 -->
            <div class="cell button" style="border-right: dashed 1px black" data-bind="style: { backgroundColor: exercise.category.colorLight, padding: (uiAmountHasFocus() ? 0 : 5) + 'px' }, click: onAmountClicked">
                <!-- ko if: !uiAmountHasFocus() -->
                    <span class="bigDigit" data-bind="text: uiAmount" /><span class="annotation" data-bind="text: RemoteTrainer.Data.UnitOfAmount[exercise.uoa]" />
                <!-- /ko -->
                <!-- ko if: uiAmountHasFocus() -->
                    <input type="number" style="width: 100%; height: 100%; border: 0px; box-sizing: border-box; font-size: 35px; font-weight: bold; text-align: center" data-bind="value: uiAmount, hasFocus: uiAmountHasFocus" />
                <!-- /ko -->
            </div>
            <!-- /ko -->
            <div class="cell button" data-bind="style: { backgroundColor: exercise.category.colorLight, padding: (uiRepsHasFocus() ? 0 : 5) + 'px' }, click: onRepsClicked">
                <!-- ko if: !uiRepsHasFocus() -->
                <span class="bigDigit" data-bind="text: uiReps" /><span class="annotation" data-bind="text: RemoteTrainer.Data.UnitOfRepetitions[exercise.uor]" />
                <!-- /ko -->
                <!-- ko if: uiRepsHasFocus() -->
                <input type="number" style="width: 100%; height: 100%; border: 0px; box-sizing: border-box; font-size: 35px; font-weight: bold; text-align: center" data-bind="value: uiReps, hasFocus: uiRepsHasFocus" />
                <!-- /ko -->
           </div>
        </div>
        <!-- ko if: order < parent.series().length - 1 || parent.uiStatus() === RemoteTrainer.Data.SerieStatus.Finished -->
        <div class="break" style="padding: 5px; box-sizing: border-box; font-size: 1em">
            &nbsp;
        </div>
        <!-- /ko -->
    </script>

    <script id="tmplOptionsRunningSerie" type="text/html">
        <div class="cell" style="flex: 1 1; text-align: center; background-color: white; border-right: solid 1px black">
            <!-- ko if: uiCountDown() -->
                <span class="bigDigit" style="color: red" data-bind="text: uiCountDown" /><span class="annotation" style="color: red"> sec</span>
            <!-- /ko -->
            <!-- ko if: !uiCountDown() -->
                <span class="bigDigit" data-bind="text: duration" /><span class="annotation"> sec</span>
            <!-- /ko -->
        </div>
    </script>

    <script id="tmplOptionsSerieComplete" type="text/html">
        <div class="cell" style="flex: 1 1; text-align: center; background-color: white; border-right: solid 1px black; display: flex; flex-direction: row">
            <div class="difficultyButton"><input type="radio" value="Very Easy" data-bind="checked: uiDifficulty, attr: { name: 'difficulty' + order }" /><br />Very Easy</div>
            <div class="difficultyButton"><input type="radio" value="Easy" data-bind="checked: uiDifficulty, attr: { name: 'difficulty' + order }" /><br />Easy</div>
            <div class="difficultyButton"><input type="radio" value="Medium" data-bind="checked: uiDifficulty, attr: { name: 'difficulty' + order }" /><br />Medium</div>
            <div class="difficultyButton"><input type="radio" value="Hard" data-bind="checked: uiDifficulty, attr: { name: 'difficulty' + order }" /><br />Hard</div>
            <div class="difficultyButton"><input type="radio" value="Very Hard" data-bind="checked: uiDifficulty, attr: { name: 'difficulty' + order }" /><br />Very Hard</div>           
        </div>
    </script>

    <script id="tmplOptionsSerieSettings" type="text/html">
        <div class="cell" style="flex: 1 1; text-align: center; background-color: white; border-right: solid 1px black">
            Nastavenia pre konkretnu serie: vynechat, zamenit, posunut na neskor...
        </div>
    </script>

    <script id="tmplOptionsSetSettings" type="text/html">
        <div class="setinfo" style="display: flex; flex-direction: row">
            <div data-bind="click: showHideSettings" style="border-right: dashed 1px black; width: 50px; background-image: url('Images/settings.png'); background-position: center; background-repeat: no-repeat; background-color: #eeeeee; background-size: 16px; cursor: pointer" />
            <div data-bind="click: modifySet" style="flex: 1; padding-left: 5px"><span class="highlight link" style="cursor: pointer">Modify</span></div>            
            <!-- ko if: next()-->
            <div data-bind="click: moveDown" style="border-left: dashed 1px black; width: 50px; background-image: url('Images/down_arrow.png'); background-position: center; background-repeat: no-repeat; background-color: #eeeeee; background-size: 16px; cursor: pointer" />
            <!-- /ko -->
            <!-- ko if: previous() && (previous().uiStatus() === RemoteTrainer.Data.SerieStatus.Queued || previous().uiStatus() === RemoteTrainer.Data.SerieStatus.Ready) -->
            <div data-bind="click: moveUp" style="border-left: dashed 1px black; width: 50px; background-image: url('Images/up_arrow.png'); background-position: center; background-repeat: no-repeat; background-color: #eeeeee; background-size: 16px; cursor: pointer" />
            <!-- /ko -->
            <div data-bind="click: remove" style="border-left: dashed 1px black; width: 50px; background-image: url('Images/trash.png'); background-position: center; background-repeat: no-repeat; background-color: #ffdddd; background-size: 16px; cursor: pointer" />
        </div>
    </script>

    <script id="tmplOverview" type="text/html">
        <!-- ko with: workout() -->
        <div style="height: 100%; width: 100%; display: flex; align-items: center; padding: 20px">
            <div style="width: 100%; height: 325px; border: solid 1px black; padding: 20px; text-align: center; background: rgba(255, 255, 255, 0.75); box-shadow: 10px 15px 2px rgba(0,0,0,0.55)">
                <!-- ko if: uiStatus() === RemoteTrainer.Data.WorkoutStatus.Ready -->
                <span class="bigestDigit">00:00</span><br /><br />
                <br />
                <img src="Images/serieStatusReady.png" style="height: 10em" data-bind="click: start" />
                <!-- /ko -->
                <!-- ko if: uiStatus() === RemoteTrainer.Data.WorkoutStatus.Running || uiStatus() === RemoteTrainer.Data.WorkoutStatus.Finished -->
                <span class="bigestDigit" data-bind="text: uiDuration" /><br />
                <br />
                <br />
                <div style="text-align: left">
                    <span style="font-size: 1em; font-weight: bold; font-style: normal">Completion:</span>
                    <div style="background: white; width: 100%; height: 30px; position: relative; border: solid 1px black">
                        <div style="position: absolute; left: 0px; top: 0px; height: 100%; width: 100%; background: linear-gradient(to right, white, #99dd44)"></div>
                        <div data-bind="style: {width: (100 - completition()) + '%'}" style="position: absolute; right: 0px; top: 0px; height: 100%; background: white"></div>
                        <div style="position: absolute; left: 0px; top: 0px; height: 100%; width: 100%; font-size: 1.5em; color: black; text-align: left; padding-left: 0.5em; font-weight: bold" data-bind="text: completition() + ' %'"></div>
                    </div>
                    <br />
                    <span style="font-size: 1em; font-weight: bold; font-style: normal">Average Difficulty:</span>
                    <div style="background: transparent; width: 100%; height: 30px; position: relative; border: solid 1px black">
                        <div style="position: absolute; left: 0px; top: 0px; height: 100%; width: 100%; background: linear-gradient(to right, white, #aa0000);"></div>
                        <div data-bind="style: {width: (100 - (averageDifficulty() * 20)) + '%'}" style="position: absolute; right: 0px; top: 0px; height: 100%; background: white;"></div>
                        <div style="position: absolute; left: 0px; top: 0px; height: 100%; width: 100%; font-size: 1.5em; color: black; text-align: left; padding-left: 0.5em; font-weight: bold" data-bind="text: averageDifficulty().toFixed(1)"></div>
                    </div>
                    <br />
                    <br />
                    <div style="width: 100%; height: 30px">
                        <div style="display: inline-block; width: 45%; padding: 0px; margin: 0px; box-sizing: border-box">
                            <span>Started On:</span> <span style="font-size: 1em; font-weight: bold; font-style: normal" data-bind="text: moment(uiStartedOn()).format('hh:mm')"></span><br />
                            <!-- ko if: uiStatus() !== RemoteTrainer.Data.WorkoutStatus.Finished -->
                            <span>Estimated End:</span> <span style="font-size: 1em; font-weight: bold; font-style: normal">10:12</span>
                            <!-- /ko -->
                            <!-- ko if: uiStatus() === RemoteTrainer.Data.WorkoutStatus.Finished -->
                            <span>Finished On:</span> <span style="font-size: 1em; font-weight: bold; font-style: normal" data-bind="text: moment(uiFinishedOn()).format('hh:mm')"></span>
                            <!-- /ko -->
                        </div>
                        <!-- ko if: uiStatus() !== RemoteTrainer.Data.WorkoutStatus.Finished -->
                        <div style="display: inline-block; width: 50%; padding: 0px; margin: 0px; box-sizing: border-box; text-align: right; cursor: pointer">
                            <img src="Images/serieStatusRunning.png" style="height:1.4em" /> <span data-bind="click: stop" style="text-decoration: underline; position: relative; top: -4px">Finish Workout</span>
                        </div>
                        <!-- /ko -->
                   </div>
                </div>
                <!-- /ko -->
            </div>
        </div>
        <!-- /ko -->
    </script>

    <script id="tmplModifySet" type="text/html">
        <!-- ko with: workout().modifiedSet() -->
            <!-- ko foreach: series() -->
            <div class="setDetail" style="margin: 10px; margin-bottom: 0px">
                <div style="display: flex; flex-direction: row; border-bottom: solid 1px black" data-bind="style: { backgroundColor: exercise.category.colorDark }">
                    <div style="flex: 1; padding: 5px; font-weight: bold" data-bind="text: exercise.name" />
                    <div data-bind="click: moveDown, style: {backgroundImage: (order() < $parent.series().length - 1) ? 'url(\'Images/down_arrow.png\')' : 'url(\'Images/down_arrow_disabled.png\')' }" style="border-left: dashed 1px black; width: 50px; background-position: center; background-repeat: no-repeat; background-color: #eeeeee; background-size: 16px; cursor: pointer" />
                    <div data-bind="click: moveUp, style: {backgroundImage: 0 < order() ? 'url(\'Images/up_arrow.png\')' : 'url(\'Images/up_arrow_disabled.png\')' }" style="border-left: dashed 1px black; width: 50px; background-position: center; background-repeat: no-repeat; background-color: #eeeeee; background-size: 16px; cursor: pointer" />
                    <div data-bind="click: remove" style="border-left: dashed 1px black; width: 50px; background-image: url('Images/trash.png'); background-position: center; background-repeat: no-repeat; background-color: #ffdddd; background-size: 16px; cursor: pointer" />
                </div>
                <div class="setinfo" style="display: flex; flex-direction: row; background: white; height: 45px">
                    <div style="flex: 1"></div>
                    <div class="cell button" style="border-left: dashed 1px black" data-bind="style: { backgroundColor: exercise.category.colorLight, padding: (uiAmountHasFocus() ? 0 : 5) + 'px' }, click: onAmountClicked">
                        <!-- ko if: !uiAmountHasFocus() -->
                        <span class="bigDigit" data-bind="text: uiAmount" /><span class="annotation" data-bind="text: RemoteTrainer.Data.UnitOfAmount[exercise.uoa]" />
                        <!-- /ko -->
                        <!-- ko if: uiAmountHasFocus() -->
                        <input type="number" style="width: 100%; height: 100%; border: 0px; box-sizing: border-box; font-size: 35px; font-weight: bold; text-align: center" data-bind="value: uiAmount, hasFocus: uiAmountHasFocus" />
                        <!-- /ko -->
                    </div>
                    <div class="cell button" style="border-left: dashed 1px black" data-bind="style: { backgroundColor: exercise.category.colorLight, padding: (uiRepsHasFocus() ? 0 : 5) + 'px' }, click: onRepsClicked">
                        <!-- ko if: !uiRepsHasFocus() -->
                        <span class="bigDigit" data-bind="text: uiReps" /><span class="annotation" data-bind="text: RemoteTrainer.Data.UnitOfRepetitions[exercise.uor]" />
                        <!-- /ko -->
                        <!-- ko if: uiRepsHasFocus() -->
                        <input type="number" style="width: 100%; height: 100%; border: 0px; box-sizing: border-box; font-size: 35px; font-weight: bold; text-align: center" data-bind="value: uiReps, hasFocus: uiRepsHasFocus" />
                        <!-- /ko -->
                    </div>
                </div>
            </div>
            <!-- /ko -->
        <!-- /ko -->
        <div class="setDetail" style="margin: 10px; margin-bottom: 0px; background: white; cursor: pointer; padding: 10px; text-align: center; font-weight: bold; font-size: 1.2em">
            <img src="Images/add.png" style="height: 16px" /> Add Serie
        </div>
</script>


</body>
</html>